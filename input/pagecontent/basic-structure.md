### Core Implementation Model for Clinical Study Schedule of Activities (SoA)
The Schedule of Activities (SoA) forms a key part of a Clinical Trial Protocol; it is usually presented as a table with the columns detailing planned study 'visits' (Encounters) and the rows the details of study activities (Activities) that are to be undertaken at that visit, and they are key to understanding how the objectives of the study are to be implemented. The table below shows a typical example SoA:

<img src="lzzt_soa_800x585.png" alt="H2Q-LZZT-MC Schedule of Activities" width="1000px" style="float:none; margin: 0px 0px 0px 0px;" />

<!-- Image Map Generated by http://www.image-map.net/ -->
<img src="lzzt_soa_800x585.png" usemap="#image-map">

<map name="image-map">
    <area target="_blank" alt="Study Schedule of Activities" title="Study Schedule of Activities" href=".../fsh/example-study-plan-h2q-mc-lzzt.fsh" coords="797,206,227,140" shape="rect">
    <area target="_blank" alt="Visit 3 (Study Encounter)" title="Visit 3 (Study Encounter)" href=".../fsh/example-study-encounter-h2q-mc-lzzt-visit-3.fsh" coords="428,146,487,584" shape="rect">
    <area target="_blank" alt="Research Study" title="Research Study" href=".../fsh/example-research-study-h2q-mc-lzzt.fsh" coords="777,93,23,8" shape="rect">
    <area target="_blank" alt="Vital Signs / Temperature (ActivityDefinition)" title="Vital Signs / Temperature (ActivityDefinition)" href=".../fsh/example-activity-definition-study-h2q-mc-lzzt.fsh" coords="" shape="rect">
</map>


* The Encounters/Visits (any planned event corresponding to clinical data collection) are represented along the horizontal axis
* The Activities (the planned activities expected to occur at the event) are represented vertically
* ... with the required Activities at each Encounter shown by a cross (X) in the matrix.

The SoA in this form represents the basic activities required at each Encounter and is usually accompanied by the details of the timings of the events (weeks) and an Encounter identifier (in the example the visit numbers... V1, V2... etc.)

The SoA table is then used as the basic building block for configuring the necessary tools and applications required to manage the progress of study participants during the study. This includes detailing activities such as when study interventions are to occur (e.g drug administration), and when required study evaluations are be made and the data collected and recorded.  

These SoA specifications form the basis for developing study specific Case Report Forms (CRFs): the primary data collection instrument.  Direct data collection and collation approaches such as the use of medical devices (Sensor Informed trials), or  remote study management (e.g. Decentralised Trials), and direct data transfer from service providers such as central laboratories require confirmed syntactic, structural and semantic interoperability.     

The FHIR standard (Fast Healthcare Interoperability Resources) is designed to support the exchange of electronic health records. The 'Definitional Artifacts' section of the 'Specialized' FHIR Resources category provides a set of FHIR Resources that are designed to enable research specifications such as those in a SoA to be represented in a standard format that can consumed by  eHR systems to plan and execute research protocols directly. 

---

The key consideration for the SoA is the collection of data to support the hypotheses presented in the Protocol. The CRFs used in Clinical Research are the primary interface for recording **outcomes** of activities.  They are designed to record the sets of data the study requires, and usually takes little account of the practical activities required to obtain the data. For FHIR specified SoAs to be successful when requirements are transcribed from the SoA for eHR implementation, a more 'workflow-based' approach to data management is required.  Specifically, transcription needs to be able to clearly define:  

* **what** activities are being done
* **when** are they being done
* the **outcomes** from those activities, and potentially
* **who** is to perform/undertake the activities

### Implementing a SoA using FHIR Resources
In order to represent the SoA we needed a set of definitional FHIR resources to represent the planned activities and the relationships between them.  The work to date has focused on a Workflow view of data management, and has leveraged the existing FHIR workflow patterns to achieve this.  

SoAs do not (a) stand alone - they are study specific, and (b) describe planned activities expected to be executed for each [Patient](http://hl7.org/fhir/Patient) recruited to the study.  Two Research-oriented resources have been used to associate SoA with the correct study and to recognise patients as being study participants:
* [ResearchStudy](http://hl7.org/fhir/ResearchStudy) - a representational artifact for a Research Study
* [ResearchSubject](http://hl7.org/fhir/ResearchSubject) - an artifact used to link a Patient research to the ResearchStudy

The project has also restricted its investigations and SoA IG development to using the [PlanDefinition](http://hl7.org/fhir/PlanDefinition) and [ActivityDefinition](http://hl7.org/fhir/ActivityDefinition). Other Structured Data Collection resources (e.g. Questionnaire, EventDefinition, etc.) have not been systematically investigated for their potential to define SoA requirements. The Workflow resources are defined on the [FHIR Workflow](https://hl7.org/fhir/workflow.html) page; the key points for modeling a SoA deal with the [Definition](https://hl7.org/fhir/workflow.html#definition) and [Request](https://hl7.org/fhir/workflow.html#request) patterns.

The Definitional Artifacts have been used to create the structure - schedule and activities - to support bot study SoA specification (definitions) and planned contextualization. 

The basic structure is summarized in the following diagram:

<img src="Vulcan-SoA-basic-structure.png" alt="Schedule of Activities Basic Structure" width="800px" style="float:none; margin: 0px 0px 0px 0px;" />

The high-level points are as follows:

* The [ResearchStudy](https://hl7.org/fhir/researchstudy.html) has at least one _protocol_ reference to a [PlanDefinition](https://hl7.org/fhir/plandefinition.html) for the Study Definition,
* Under the Study Definition there are references to each of the planned encounters/visits through the _action_ predicate,  
* Each planned encounter/visit has references to each of the planned activities through the _action_ predicate

Th _action_ predicate defines the relationships between activities, such as what activities are to be done and when they are planned to be done.

{% include plandef-actions.svg %}

In Research protocols many of the activities are event based. For example;  Informed Consent is required prior to any study activities commencing.  This is modeled using the _relatedAction_ predicate on the _action_ predicate. This is illustrated in the above diagram.  The `Baseline` Encounter is annotated in the design.  The other encounters are defined as being _before_ or _after_ this action.  

It is also possible to define the interval between these actions as illustrated in the [Protocol Design Example](PlanDefinition-H2Q-MC-LZZT-ProtocolDesign.html).  The planned event `Visit-3` has an _id_ assigned to it. Prior and subsequent activities use the _relatedAction.actionId_ to reference the pivot activity.  This allows elementary sequencing of planned elements to represent the SoA.  This sample also represents a simple windowing capability for scheduling activities relative to the index event.  There is a separate use case to address how targeted windows can be applied to the scheduling of study activities.

This is also illustrated within an encounter in the [Visit 1](PlanDefinition-H2Q-MC-LZZT-Study-Visit-1.html) and [Visit 3](PlanDefinition-H2Q-MC-LZZT-Study-Visit-3.html) examples.  Within an encounter tasks are defined using [ActivityDefinition](http://hl7.org/fhir/ActivityDefinition) resources, and key tasks have a _action.id_ attribute; tasks that should occur relative to the key task reference the task via the _action.relatedAction_ attribute.  In the H2Q-MC-LZZT study within-encounter activities are not as structured as they would be for say a Phase I Pharmacokinetic study, so the activities are defined as being before or after the key task (a specific example includes study data collection activities strictly occurring after collection of informed consent).

#### Observations on how the SoA can be implemented

Given the structure discussed above, consideration has been given to how best to implement/use the planned activities within an Electronic Healthcare Record System; particularly how they can be used to manage the progress of a [ResearchSubject](http://hl7.org/fhir/ResearchSubject) through the study.   

Following the [FHIR Workflow](https://hl7.org/fhir/workflow.html) paradigm, what needs to be done has been defined using the [Definition](https://hl7.org/fhir/definition.html) patterns, which are scheduled using [Request](https://hl7.org/fhir/request.html) patterns and ultimately manifested as [Event](https://hl7.org/fhir/event.html) patterns.   The current implementation examples are constrained to the minimum requirement in order that the core concepts in a clinical trial protocol are accurately modelled

The example below shows how a defined study plan can be related to an executed activity and the required outcomes/results.

{% include implementation-plan-def.svg %}

While the diagram may look complex it is methodologically sound as it builds out an approach using a set of common archetypes.  There is a flow of planned -> scheduled -> performed activities that IG implementers can follow to build processes and software meeting the SoA objectives.  This serves as a way to drive data collection (for both prospective and retrospective use cases) and it provides a broad scope for current and future use cases.  Please note, that much of the workflow is not shown in this representation; there are no references to scheduling and orchestration resources (eg [Appointment](https://hl7.org/fhir/appointment.html), [AppointmentResponse](https://hl7.org/fhir/appointmentresponse.html) )

**Note:** The SoA Working group team has relied heavily on the Workflow patterns as mentioned in the core specification as a how the process of data collection _could_ proceed, without being prescriptive about how activities _should_ be manifested in the many systems that are involved in the day to day execution of healthcare.  

The SoA FHIR IG assumes that how activities/tasks get executed is dependent on their respective services, procedures, and administrative mechanisms. The working group has assumed that it will vary dependent on the scenario and how each system, application, device, etc. are setup.

